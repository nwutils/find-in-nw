/**
 * findAndReplaceDOMText v 0.4.6
 * @author James Padolsey http://james.padolsey.com
 * @license http://unlicense.org/UNLICENSE
 *
 * Matches the text of a DOM node against a regular expression
 * and replaces each match (or node-separated portions of the match)
 * in the specified element.
 */
!function(e,t){"object"==typeof module&&module.exports?module.exports=t():"function"==typeof define&&define.amd?define(t):e.findAndReplaceDOMText=t()}(this,(function(){var e=document,t={}.hasOwnProperty;function n(){return i.apply(null,arguments)||o.apply(null,arguments)}function i(e,t,i,r,d){if(t&&!t.nodeType&&arguments.length<=2)return!1;var s,a="function"==typeof i;a&&(s=i,i=function(e,t){return s(e.text,t.startIndex)});var c=o(t,{find:e,wrap:a?null:i,replace:a?i:"$"+(r||"&"),prepMatch:function(e,t){if(!e[0])throw"findAndReplaceDOMText cannot handle zero-length matches";if(r>0){var n=e[r];e.index+=e[0].indexOf(n),e[0]=n}return e.endIndex=e.index+e[0].length,e.startIndex=e.index,e.index=t,e},filterElements:d});return n.revert=function(){return c.revert()},!0}function o(e,t){return new r(e,t)}function r(e,i){var o=i.preset&&n.PRESETS[i.preset];if(i.portionMode=i.portionMode||"retain",o)for(var r in o)t.call(o,r)&&!t.call(i,r)&&(i[r]=o[r]);this.node=e,this.options=i,this.prepMatch=i.prepMatch||this.prepMatch,this.reverts=[],this.matches=this.search(),this.matches.length&&this.processMatches()}return n.NON_PROSE_ELEMENTS={br:1,hr:1,script:1,style:1,img:1,video:1,audio:1,canvas:1,svg:1,map:1,object:1,input:1,textarea:1,select:1,option:1,optgroup:1,button:1},n.NON_CONTIGUOUS_PROSE_ELEMENTS={address:1,article:1,aside:1,blockquote:1,dd:1,div:1,dl:1,fieldset:1,figcaption:1,figure:1,footer:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,header:1,hgroup:1,hr:1,main:1,nav:1,noscript:1,ol:1,output:1,p:1,pre:1,section:1,ul:1,br:1,li:1,summary:1,dt:1,details:1,rp:1,rt:1,rtc:1,script:1,style:1,img:1,video:1,audio:1,canvas:1,svg:1,map:1,object:1,input:1,textarea:1,select:1,option:1,optgroup:1,button:1,table:1,tbody:1,thead:1,th:1,tr:1,td:1,caption:1,col:1,tfoot:1,colgroup:1},n.NON_INLINE_PROSE=function(e){return t.call(n.NON_CONTIGUOUS_PROSE_ELEMENTS,e.nodeName.toLowerCase())},n.PRESETS={prose:{forceContext:n.NON_INLINE_PROSE,filterElements:function(e){return!t.call(n.NON_PROSE_ELEMENTS,e.nodeName.toLowerCase())}}},n.Finder=r,r.prototype={search:function(){var e,t=0,n=0,i=this.options.find,o=this.getAggregateText(),r=[],d=this;return i="string"==typeof i?RegExp(String(i).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1"),"g"):i,function o(s){for(var a=0,c=s.length;a<c;++a){var u=s[a];if("string"==typeof u){if(i.global)for(;e=i.exec(u);)r.push(d.prepMatch(e,t++,n));else(e=u.match(i))&&r.push(d.prepMatch(e,0,n));n+=u.length}else o(u)}}(o),r},prepMatch:function(e,t,n){if(!e[0])throw new Error("findAndReplaceDOMText cannot handle zero-length matches");return e.endIndex=n+e.index+e[0].length,e.startIndex=n+e.index,e.index=t,e},getAggregateText:function(){var e=this.options.filterElements,t=this.options.forceContext;return function n(i){if(i.nodeType===Node.TEXT_NODE)return[i.data];if(e&&!e(i))return[];var o=[""],r=0;if(i=i.firstChild)do{if(i.nodeType!==Node.TEXT_NODE){var d=n(i);t&&i.nodeType===Node.ELEMENT_NODE&&(!0===t||t(i))?(o[++r]=d,o[++r]=""):("string"==typeof d[0]&&(o[r]+=d.shift()),d.length&&(o[++r]=d,o[++r]=""))}else o[r]+=i.data}while(i=i.nextSibling);return o}(this.node)},processMatches:function(){var e,t,n,i=this.matches,o=this.node,r=this.options.filterElements,d=[],s=o,a=i.shift(),c=0,u=0,h=[o];e:for(;;){if(s.nodeType===Node.TEXT_NODE&&(!t&&s.length+c>=a.endIndex?t={node:s,index:u++,text:s.data.substring(a.startIndex-c,a.endIndex-c),indexInMatch:0===c?0:c-a.startIndex,indexInNode:a.startIndex-c,endIndexInNode:a.endIndex-c,isEnd:!0}:e&&d.push({node:s,index:u++,text:s.data,indexInMatch:c-a.startIndex,indexInNode:0}),!e&&s.length+c>a.startIndex&&(e={node:s,index:u++,indexInMatch:0,indexInNode:a.startIndex-c,endIndexInNode:a.endIndex-c,text:s.data.substring(a.startIndex-c,a.endIndex-c)}),c+=s.data.length),n=s.nodeType===Node.ELEMENT_NODE&&r&&!r(s),e&&t){if(s=this.replaceMatch(a,e,d,t),c-=t.node.data.length-t.endIndexInNode,e=null,t=null,d=[],u=0,!(a=i.shift()))break}else if(!n&&(s.firstChild||s.nextSibling)){s.firstChild?(h.push(s),s=s.firstChild):s=s.nextSibling;continue}for(;;){if(s.nextSibling){s=s.nextSibling;break}if((s=h.pop())===o)break e}}},revert:function(){for(var e=this.reverts.length;e--;)this.reverts[e]();this.reverts=[]},prepareReplacementString:function(e,t,n){var i=this.options.portionMode;return"first"===i&&t.indexInMatch>0?"":(e=e.replace(/\$(\d+|&|`|')/g,(function(e,t){var i;switch(t){case"&":i=n[0];break;case"`":i=n.input.substring(0,n.startIndex);break;case"'":i=n.input.substring(n.endIndex);break;default:i=n[+t]||""}return i})),"first"===i?e:t.isEnd?e.substring(t.indexInMatch):e.substring(t.indexInMatch,t.indexInMatch+t.text.length))},getPortionReplacementNode:function(t,n){var i=this.options.replace||"$&",o=this.options.wrap,r=this.options.wrapClass;if(o&&o.nodeType){var d=e.createElement("div");d.innerHTML=o.outerHTML||(new XMLSerializer).serializeToString(o),o=d.firstChild}if("function"==typeof i)return(i=i(t,n))&&i.nodeType?i:e.createTextNode(String(i));var s="string"==typeof o?e.createElement(o):o;return s&&r&&(s.className=r),(i=e.createTextNode(this.prepareReplacementString(i,t,n))).data&&s?(s.appendChild(i),s):i},replaceMatch:function(t,n,i,o){var r,d,s=n.node,a=o.node;if(s===a){var c=s;n.indexInNode>0&&(r=e.createTextNode(c.data.substring(0,n.indexInNode)),c.parentNode.insertBefore(r,c));var u=this.getPortionReplacementNode(o,t);return c.parentNode.insertBefore(u,c),o.endIndexInNode<c.length&&(d=e.createTextNode(c.data.substring(o.endIndexInNode)),c.parentNode.insertBefore(d,c)),c.parentNode.removeChild(c),this.reverts.push((function(){r===u.previousSibling&&r.parentNode.removeChild(r),d===u.nextSibling&&d.parentNode.removeChild(d),u.parentNode.replaceChild(c,u)})),u}r=e.createTextNode(s.data.substring(0,n.indexInNode)),d=e.createTextNode(a.data.substring(o.endIndexInNode));for(var h=this.getPortionReplacementNode(n,t),l=[],p=0,f=i.length;p<f;++p){var g=i[p],x=this.getPortionReplacementNode(g,t);g.node.parentNode.replaceChild(x,g.node),this.reverts.push(function(e,t){return function(){t.parentNode.replaceChild(e.node,t)}}(g,x)),l.push(x)}var m=this.getPortionReplacementNode(o,t);return s.parentNode.insertBefore(r,s),s.parentNode.insertBefore(h,s),s.parentNode.removeChild(s),a.parentNode.insertBefore(m,a),a.parentNode.insertBefore(d,a),a.parentNode.removeChild(a),this.reverts.push((function(){r.parentNode.removeChild(r),h.parentNode.replaceChild(s,h),d.parentNode.removeChild(d),m.parentNode.replaceChild(a,m)})),m}},n}));const table={find:[],position:[]},start={find:0,position:0};function timer(e){let t=new Date-start[e];table[e].push(Math.round(t))}const findInNw={initialized:!1,lastSearched:"",total:0,currentToken:0,dataAttribute:"data-find-in-nw-position",debounceAmount:0,debounceTimeout:null,resetState:function(){this.lastSearched="",this.total=0,this.currentToken=0},debouncedSearch:function(e){clearTimeout(this.debounceTimeout),this.debounceTimeout=setTimeout(()=>{this.debounceTimeout=null,this.search(e)},this.debounceAmount)},validateSettings:function(e){return e&&!Array.isArray(e)&&"object"==typeof e||(e={}),e.debounce&&"number"==typeof e.debounce&&!isNaN(e.debounce)||(e.debounce=0),e},applySettings:function(e){e=this.validateSettings(e),this.debounceAmount=e.debounce},create:{css:".find-in-nw-search-box{position:fixed;top:10px;right:10px;display:none;width:300px;background:#f1f1f1;border:1px solid #c1c1c1;border-radius:7px;margin:0px;padding:0px;box-shadow:1px 3px 9px rgba(0,0,0,.6)}.find-in-nw-search-box-visible{display:flex}.find-in-nw-input{flex-grow:1;width:100%;background:transparent;border:0px;margin:0px;padding:0px 0px 0px 3px;font-size:16px}.find-in-nw-previous,.find-in-nw-next,.find-in-nw-close{width:32px;background:transparent;border:0px;margin:0px 5px 0px 0px;padding:0px;font-size:32px;opacity:.5}.find-in-nw-previous:hover,.find-in-nw-next:hover,.find-in-nw-close:hover{opacity:1}.find-in-nw-search-box,.find-in-nw-input,.find-in-nw-count,.find-in-nw-previous,.find-in-nw-next,.find-in-nw-close{height:32px;color:#000;font-family:sans-serif;line-height:32px;vertical-align:top}.find-in-nw-input:focus,.find-in-nw-previous:focus,.find-in-nw-next:focus,.find-in-nw-close:focus{opacity:1;outline:none}.find-in-nw-previous,.find-in-nw-next{font-size:30px;transform:scale(1.5, 0.7)}.find-in-nw-count{margin-right:8px}.find-in-nw-token{background-color:#ff0}.find-in-nw-current-token{background:#38d878;color:#fff}",style:function(){const e=document.createElement("style");return e.setAttribute("id","find-in-nw-style"),e.innerText=this.css,e},container:function(){const e=document.createElement("div");return e.setAttribute("id","find-in-nw-search-box"),e.setAttribute("class","find-in-nw-search-box"),e},input:function(){const e=document.createElement("input");return e.setAttribute("id","find-in-nw-input"),e.setAttribute("class","find-in-nw-input"),e.setAttribute("placeholder","Find"),e},element:function(e,t,n){const i=document.createElement(e);return i.setAttribute("id","find-in-nw-"+t),i.setAttribute("class","find-in-nw-"+t),i.innerHTML=n+"",i},composeSearchBox:function(){const e=this.container();return e.appendChild(this.input()),e.appendChild(this.element("span","current",0)),e.appendChild(this.element("span","of","/")),e.appendChild(this.element("span","count",0)),e.appendChild(this.element("button","previous","&and;")),e.appendChild(this.element("button","next","&or;")),e.appendChild(this.element("button","close","&times;")),e}},keyDownPressed:function(){document.getElementById("find-in-nw-input").addEventListener("keydown",function(e){"Enter"===e.key&&this.highlightNext()}.bind(this))},inputChanged:function(){document.getElementById("find-in-nw-input").addEventListener("input",function(e){e.preventDefault();const t=e.target.value;t&&t!==this.lastSearched?this.debouncedSearch(t):t||(clearTimeout(this.debounceTimeout),this.clearTokens())}.bind(this))},previousButtonClicked:function(){document.getElementById("find-in-nw-previous").addEventListener("click",function(e){e.preventDefault(),this.highlightPrevious()}.bind(this))},nextButtonClicked:function(){document.getElementById("find-in-nw-next").addEventListener("click",function(e){e.preventDefault(),this.highlightNext()}.bind(this))},closeButtonClicked:function(){document.getElementById("find-in-nw-close").addEventListener("click",function(e){e.preventDefault(),this.hideSearchBox()}.bind(this))},eventBinding:function(){this.keyDownPressed(),this.inputChanged(),this.previousButtonClicked(),this.nextButtonClicked(),this.closeButtonClicked()},keyBindings:function(){document.onkeydown=function(e){return e.ctrlKey&&70===e.keyCode?(e.preventDefault(),this.showSearchBox(),!1):27===e.keyCode?(e.preventDefault(),this.hideSearchBox(),!1):void 0}.bind(this)},highlightPrevious:function(){this.currentToken=this.currentToken-1,this.currentToken<0&&(this.currentToken=this.total-1),this.updateCount(),this.highlightCurrentToken()},highlightNext:function(){this.currentToken=this.currentToken+1,this.currentToken>this.total-1&&(this.currentToken=0),this.updateCount(),this.highlightCurrentToken()},showSearchBox:function(){const e=document.getElementById("find-in-nw-search-box"),t=document.getElementById("find-in-nw-input");e.classList.add("find-in-nw-search-box-visible");const n=window.getSelection().toString();n&&n.indexOf("\n")<0&&(t.value=n),t.value&&this.search(t.value),t.focus()},hideSearchBox:function(){document.getElementById("find-in-nw-search-box").classList.remove("find-in-nw-search-box-visible"),document.body.focus(),this.clearTokens()},getElementsToSearch:function(){const e=[];for(let t=0;t<document.body.children.length;t++){let n=document.body.children[t];"style"!==n.tagName.toLowerCase()&&"script"!==n.tagName.toLowerCase()&&e.push(n)}return e},setDataPositionAttribute:function(){let e=0,t=this.lastSearched.length,n=t;const i=document.getElementsByClassName("find-in-nw-token");[...i].forEach(function(i){let o=i.innerText.length;i.setAttribute(this.dataAttribute,e),o===t?(e+=1,n=t):(n-=o,n<1&&(e+=1,n=t))}.bind(this)),i||(e=0),this.total=e},highlightCurrentToken:function(){let e=document.getElementsByClassName("find-in-nw-current-token"),t=document.querySelectorAll(".find-in-nw-token["+this.dataAttribute+'="'+this.currentToken+'"]');e&&e.length&&(e=[...e],e.forEach((function(e){e.classList.remove("find-in-nw-current-token")}))),t&&t.length&&(t=[...t],t.forEach((function(e){e.classList.add("find-in-nw-current-token")})),t[0].scrollIntoView({behavior:"auto",block:"center",inline:"center"}))},updateCount:function(){const e=document.getElementById("find-in-nw-current"),t=document.getElementById("find-in-nw-count");let n=0;0!==this.total&&(n=this.currentToken+1),e.innerHTML=n.toLocaleString(),t.innerHTML=this.total.toLocaleString()},clearTokens:function(){const e=document.getElementsByClassName("find-in-nw-token");let t=[];for(let n=0;n<e.length;n++)t.push(e[n].parentNode);for(t=Array.from(new Set(t));e.length;)e[0].replaceWith(...e[0].childNodes);t.forEach((function(e){e.normalize()})),this.resetState(),this.updateCount()},search:function(e){this.clearTokens();const t=this.getElementsToSearch();start.find=new Date,t.forEach((function(t){window.findAndReplaceDOMText(t,{find:e,wrap:"mark",wrapClass:"find-in-nw-token"})})),timer("find"),this.lastSearched=e,start.position=new Date,this.setDataPositionAttribute(),timer("position"),this.updateCount(),this.highlightCurrentToken(),console.table(table)},initialize:function(e){if(!this.initialized){const t=this.create.style(),n=this.create.composeSearchBox();document.body.append(n),document.body.append(t),this.keyBindings(),this.eventBinding(),this.applySettings(e),this.initialized=!0}}};
